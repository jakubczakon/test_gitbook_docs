<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.1" />
<title>neptunecontrib.bots.telegram_bot API documentation</title>
<meta name="description" content="Spins of a Neptune bot with which you can interact on telegram â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>neptunecontrib.bots.telegram_bot</code></h1>
</header>
<section id="section-intro">
<p>Spins of a Neptune bot with which you can interact on telegram</p>
<p>You can see which experiments are running, check the best experiements based
on defined metric and even plot it in Telegram.</p>
<p>Full list of options:
* /project list NAMESPACE
* /project select NAMESPACE/PROJECT_NAME
* /project help
* /experiments last NUMBER_OF_EXPERIMENTS
* /experiments best METRIC_NAME NUMBER_OF_EXPERIMENTS
* /experiments state STATE NUMBER_OF_EXPERIMENTS
* /experiments help
* /experiment link SHORT_ID
* /experiment plot SHORT_ID METRIC_NAME OTHER_METRIC_NAME
* /experiment help</p>
<h2 id="attributes">Attributes</h2>
<p>telegram_api_token(str): Your telegram bot api token.
You can pass it either as &ndash;telegram_api_token or -t.
neptune_api_token(str): Your neptune api token. If you
set the NEPTUNE_API_TOKEN environemnt variable, you
don't have to pass it here.
You can pass it either as &ndash;neptune_api_token or -n.
Default None.</p>
<h2 id="example">Example</h2>
<p>Spin off your bot::</p>
<pre><code>$ python neptunecontrib.bots.telegram
    --telegram_api_token 'a1249auscvas0vbia0fias0'
    --neptune_api_token 'asdjpsvdsg987das0f9sad0fjasdf='
</code></pre>
<p>Go to your telegram and type.</p>
<p><code>/project list neptune-ai</code></p>
<p>Use help to see what is implemented.</p>
<ul>
<li>'/project help'</li>
<li>'/experiments help'</li>
<li>'/experiemnt help'</li>
</ul>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#
# Copyright (c) 2019, Neptune Labs Sp. z o.o.
#
# Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

&#34;&#34;&#34;Spins of a Neptune bot with which you can interact on telegram

You can see which experiments are running, check the best experiements based
on defined metric and even plot it in Telegram.

Full list of options:
 * /project list NAMESPACE
 * /project select NAMESPACE/PROJECT_NAME
 * /project help
 * /experiments last NUMBER_OF_EXPERIMENTS
 * /experiments best METRIC_NAME NUMBER_OF_EXPERIMENTS
 * /experiments state STATE NUMBER_OF_EXPERIMENTS
 * /experiments help
 * /experiment link SHORT_ID
 * /experiment plot SHORT_ID METRIC_NAME OTHER_METRIC_NAME
 * /experiment help

Attributes:
    telegram_api_token(str): Your telegram bot api token.
        You can pass it either as --telegram_api_token or -t.
    neptune_api_token(str): Your neptune api token. If you
        set the NEPTUNE_API_TOKEN environemnt variable, you
        don&#39;t have to pass it here.
        You can pass it either as --neptune_api_token or -n.
        Default None.

Example:
    Spin off your bot::

        $ python neptunecontrib.bots.telegram
            --telegram_api_token &#39;a1249auscvas0vbia0fias0&#39;
            --neptune_api_token &#39;asdjpsvdsg987das0f9sad0fjasdf=&#39;

    Go to your telegram and type.

    `/project list neptune-ai`

    Use help to see what is implemented.

     * &#39;/project help&#39;
     * &#39;/experiments help&#39;
     * &#39;/experiemnt help&#39;

&#34;&#34;&#34;

import argparse
from io import BytesIO

from neptune.sessions import Session
import matplotlib.pyplot as plt
import pandas as pd
from telegram.ext import Updater
from telegram.ext import CommandHandler, MessageHandler, Filters


class TelegramBot:
    def __init__(self, telegram_api_token, neptune_api_token):
        self.session = Session(api_token=neptune_api_token)
        self.updater = Updater(token=telegram_api_token)
        self.dispatcher = self.updater.dispatcher
        self.neptune_project = None
        self.project_name = None

        self.dispatcher.add_handler(CommandHandler(&#39;project&#39;, self.project, pass_args=True))
        self.dispatcher.add_handler(CommandHandler(&#39;experiments&#39;, self.experiments, pass_args=True))
        self.dispatcher.add_handler(CommandHandler(&#39;experiment&#39;, self.experiment, pass_args=True))
        self.dispatcher.add_handler(MessageHandler(Filters.command, self.unknown))

    def run(self):
        self.updater.start_polling()

    def project(self, bot, update, args):
        if args:
            if args[0] == &#39;select&#39;:
                self._project_select(bot, update, args)
            elif args[0] == &#39;list&#39;:
                self._project_list(bot, update, args)
            else:
                self._project_help(bot, update)
        else:
            self._project_help(bot, update)

    def experiments(self, bot, update, args):
        if not self.neptune_project:
            self._no_project_selected(bot, update)
        else:
            if args:
                if args[0] == &#39;last&#39;:
                    self._experiments_last(bot, update, args)
                elif args[0] == &#39;best&#39;:
                    self._experiments_best(bot, update, args)
                elif args[0] == &#39;state&#39;:
                    self._experiments_state(bot, update, args)
                else:
                    self._experiments_help(bot, update)
            else:
                self._experiments_help(bot, update)

    def experiment(self, bot, update, args):
        if not self.neptune_project:
            self._no_project_selected(bot, update)
        else:
            if args:
                if args[0] == &#39;link&#39;:
                    self._experiment_link(bot, update, args)
                elif args[0] == &#39;plot&#39;:
                    self._experiment_plot(bot, update, args)
                else:
                    self._experiment_help(bot, update)
            else:
                self._experiment_help(bot, update)

    def unknown(self, bot, update):
        bot.send_message(chat_id=update.message.chat_id,
                         text=&#34;Sorry, I only undestand /project, /experiments, /experiment&#34;)

    def _project_list(self, bot, update, args):
        if len(args) != 2:
            msg = [&#39;message should have a format:&#39;,
                   &#39;/project list NAMESPACE&#39;,
                   &#39;for example:&#39;,
                   &#39;/project list neptune-ai&#39;]
            msg = &#39;\n&#39;.join(msg)
        else:
            namespace = args[1]
            project_names = self.session.get_projects(namespace).keys()
            msg = &#39;\n&#39;.join(project_names)
        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _project_select(self, bot, update, args):
        if len(args) != 2:
            msg = [&#39;message should have a format:&#39;,
                   &#39;/project select NAMESPACE/PROJECT_NAME&#39;,
                   &#39;for example:&#39;,
                   &#39;/project select neptune-ai/neptune-examples&#39;]
            msg = &#39;\n&#39;.join(msg)
        else:
            self.project_name = args[1]
            namespace = self.project_name.split(&#39;/&#39;)[0]
            self.neptune_project = self.session.get_projects(namespace)[self.project_name]

            msg = &#39;Selected a project: {}&#39;.format(self.project_name)
        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _project_help(self, bot, update):
        msg = &#34;&#34;&#34;Available options are:\n
        /project list NAMESPACE
        /project select NAMESPACE/PROJECT_NAME
        &#34;&#34;&#34;
        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _experiments_last(self, bot, update, args):
        if len(args) != 3:
            msg = [&#39;message should have a format:&#39;,
                   &#39;/experiments last NR_EXPS TIMESTAMP&#39;,
                   &#39;for example:&#39;,
                   &#39;/experiments last 5 finished&#39;]
            msg = &#39;\n&#39;.join(msg)
        else:
            nr_exps = int(args[1])
            timestamp = args[2]

            if timestamp not in [&#39;created&#39;, &#39;finished&#39;]:
                msg = &#39;choose created or finished as timestamp&#39;
            else:
                leaderboard = self.neptune_project.get_leaderboard()
                leaderboard[timestamp] = pd.to_datetime(leaderboard[timestamp])
                leaderboard.sort_values(timestamp, ascending=False, inplace=True)
                ids = leaderboard[&#39;id&#39;].tolist()[:nr_exps]
                ids = [&#39;id&#39;] + ids
                msg = &#39;\n&#39;.join(ids)

        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _experiments_best(self, bot, update, args):
        if len(args) != 3:
            msg = [&#39;message should have a format:&#39;,
                   &#39;/experiments best METRIC NR_EXPS&#39;,
                   &#39;for example:&#39;,
                   &#39;/experiments best log_loss 3&#39;]
            msg = &#39;\n&#39;.join(msg)
        else:
            metric_name = args[1]
            metric_column = &#39;channel_&#39; + metric_name
            nr_exps = int(args[2])

            leaderboard = self.neptune_project.get_leaderboard()
            scores = leaderboard.sort_values([metric_column], ascending=False)[[&#39;id&#39;, metric_column]]

            msg = &#39;id | {}\n&#39;.format(metric_name)
            for idx, metric in scores.values[:nr_exps]:
                msg = msg + &#39;{} | {}\n&#39;.format(idx, metric)

        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _experiments_state(self, bot, update, args):
        if len(args) != 3:
            msg = [&#39;message should have a format:&#39;,
                   &#39;/experiments state STATE NR_EXPS&#39;,
                   &#39;for example:&#39;,
                   &#39;/experiments state running 4&#39;]
            msg = &#39;\n&#39;.join(msg)
        else:
            state = args[1]
            nr_exps = int(args[2])
            leaderboard = self.neptune_project.get_leaderboard(state=state)
            leaderboard[&#39;created&#39;] = pd.to_datetime(leaderboard[&#39;created&#39;])
            leaderboard.sort_values(&#39;created&#39;, ascending=False, inplace=True)
            ids = leaderboard[&#39;id&#39;].tolist()[:nr_exps]
            ids = [&#39;id&#39;] + ids
            msg = &#39;\n&#39;.join(ids)
        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _experiments_help(self, bot, update):
        msg = &#34;&#34;&#34;Available options are:\n
        /experiments last NR_EXPS
        /experiments best METRIC_NAME NR_EXPS(optional)
        /experiments state STATE NR_EXPS(optional)
        &#34;&#34;&#34;
        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _experiment_link(self, bot, update, args):
        if len(args) != 2:
            msg = [&#39;message should have a format:&#39;,
                   &#39;/experiment link SHORT_ID&#39;,
                   &#39;for example:&#39;,
                   &#39;/experiment link NEP-508&#39;]
            msg = &#39;\n&#39;.join(msg)
        else:
            short_id = args[1]
            namespace, project = self.project_name.split(&#39;/&#39;)

            msg = &#39;https://ui.neptune.ai/o/{}/org/{}/e/{}/details&#39;.format(namespace, project, short_id)
        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _experiment_plot(self, bot, update, args):
        if len(args) &lt; 3:
            msg = [&#39;message should have a format:&#39;,
                   &#39;/experiment plot SHORT_ID METRIC_NAME OTHER_METRIC_NAME&#39;,
                   &#39;for example:&#39;,
                   &#39;/experiment plot NEP-508 train_loss valid_loss&#39;]
            msg = &#39;\n&#39;.join(msg)
            bot.send_message(chat_id=update.message.chat_id, text=msg)
        else:
            short_id = args[1]
            if len(args) == 2:
                metric_names = [args[2]]
            else:
                metric_names = args[2:]

            experiment = self.neptune_project.get_experiments(id=short_id)[0]
            data = experiment.get_numeric_channels_values(*metric_names)

            fig = plt.figure()
            for channel_name in data.columns:
                if channel_name != &#39;x&#39;:
                    plt.plot(&#39;x&#39;, channel_name, data=data,
                             marker=&#39;&#39;, linewidth=2, label=channel_name)
            plt.legend()

            buffer = BytesIO()
            fig.savefig(buffer, format=&#39;png&#39;)
            buffer.seek(0)
            update.message.reply_photo(buffer)

    def _experiment_help(self, bot, update):
        msg = &#34;&#34;&#34;Available options are:\n
        /experiment link SHORT_ID
        /experiments plot SHORT_ID METRIC_NAME (OTHER_METRIC_NAME) 
        &#34;&#34;&#34;
        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _no_project_selected(self, bot, update):
        msg = [&#34;You haven&#39;t selected your project.&#34;,
               &#34;Do so by running:\n&#34;
               &#34;/project select NAMESPACE/PROJECT_NAME&#34;,
               &#34;For example:&#34;,
               &#34;/project select neptune-ai/neptune-examples&#34;]
        msg = &#39;\n&#39;.join(msg)
        bot.send_message(chat_id=update.message.chat_id, text=msg)


def parse_args():
    parser = argparse.ArgumentParser()
    parser.add_argument(&#39;-t&#39;, &#39;--telegram_api_token&#39;)
    parser.add_argument(&#39;-n&#39;, &#39;--neptune_api_token&#39;, default=None)
    return parser.parse_args()


if __name__ == &#39;__main__&#39;:
    arguments = parse_args()

    telegram_bot = TelegramBot(telegram_api_token=arguments.telegram_api_token,
                               neptune_api_token=arguments.neptune_api_token)

    while True:
        telegram_bot.run()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="neptunecontrib.bots.telegram_bot.parse_args"><code class="name flex">
<span>def <span class="ident">parse_args</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def parse_args():
    parser = argparse.ArgumentParser()
    parser.add_argument(&#39;-t&#39;, &#39;--telegram_api_token&#39;)
    parser.add_argument(&#39;-n&#39;, &#39;--neptune_api_token&#39;, default=None)
    return parser.parse_args()</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="neptunecontrib.bots.telegram_bot.TelegramBot"><code class="flex name class">
<span>class <span class="ident">TelegramBot</span></span>
<span>(</span><span>telegram_api_token, neptune_api_token)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class TelegramBot:
    def __init__(self, telegram_api_token, neptune_api_token):
        self.session = Session(api_token=neptune_api_token)
        self.updater = Updater(token=telegram_api_token)
        self.dispatcher = self.updater.dispatcher
        self.neptune_project = None
        self.project_name = None

        self.dispatcher.add_handler(CommandHandler(&#39;project&#39;, self.project, pass_args=True))
        self.dispatcher.add_handler(CommandHandler(&#39;experiments&#39;, self.experiments, pass_args=True))
        self.dispatcher.add_handler(CommandHandler(&#39;experiment&#39;, self.experiment, pass_args=True))
        self.dispatcher.add_handler(MessageHandler(Filters.command, self.unknown))

    def run(self):
        self.updater.start_polling()

    def project(self, bot, update, args):
        if args:
            if args[0] == &#39;select&#39;:
                self._project_select(bot, update, args)
            elif args[0] == &#39;list&#39;:
                self._project_list(bot, update, args)
            else:
                self._project_help(bot, update)
        else:
            self._project_help(bot, update)

    def experiments(self, bot, update, args):
        if not self.neptune_project:
            self._no_project_selected(bot, update)
        else:
            if args:
                if args[0] == &#39;last&#39;:
                    self._experiments_last(bot, update, args)
                elif args[0] == &#39;best&#39;:
                    self._experiments_best(bot, update, args)
                elif args[0] == &#39;state&#39;:
                    self._experiments_state(bot, update, args)
                else:
                    self._experiments_help(bot, update)
            else:
                self._experiments_help(bot, update)

    def experiment(self, bot, update, args):
        if not self.neptune_project:
            self._no_project_selected(bot, update)
        else:
            if args:
                if args[0] == &#39;link&#39;:
                    self._experiment_link(bot, update, args)
                elif args[0] == &#39;plot&#39;:
                    self._experiment_plot(bot, update, args)
                else:
                    self._experiment_help(bot, update)
            else:
                self._experiment_help(bot, update)

    def unknown(self, bot, update):
        bot.send_message(chat_id=update.message.chat_id,
                         text=&#34;Sorry, I only undestand /project, /experiments, /experiment&#34;)

    def _project_list(self, bot, update, args):
        if len(args) != 2:
            msg = [&#39;message should have a format:&#39;,
                   &#39;/project list NAMESPACE&#39;,
                   &#39;for example:&#39;,
                   &#39;/project list neptune-ai&#39;]
            msg = &#39;\n&#39;.join(msg)
        else:
            namespace = args[1]
            project_names = self.session.get_projects(namespace).keys()
            msg = &#39;\n&#39;.join(project_names)
        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _project_select(self, bot, update, args):
        if len(args) != 2:
            msg = [&#39;message should have a format:&#39;,
                   &#39;/project select NAMESPACE/PROJECT_NAME&#39;,
                   &#39;for example:&#39;,
                   &#39;/project select neptune-ai/neptune-examples&#39;]
            msg = &#39;\n&#39;.join(msg)
        else:
            self.project_name = args[1]
            namespace = self.project_name.split(&#39;/&#39;)[0]
            self.neptune_project = self.session.get_projects(namespace)[self.project_name]

            msg = &#39;Selected a project: {}&#39;.format(self.project_name)
        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _project_help(self, bot, update):
        msg = &#34;&#34;&#34;Available options are:\n
        /project list NAMESPACE
        /project select NAMESPACE/PROJECT_NAME
        &#34;&#34;&#34;
        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _experiments_last(self, bot, update, args):
        if len(args) != 3:
            msg = [&#39;message should have a format:&#39;,
                   &#39;/experiments last NR_EXPS TIMESTAMP&#39;,
                   &#39;for example:&#39;,
                   &#39;/experiments last 5 finished&#39;]
            msg = &#39;\n&#39;.join(msg)
        else:
            nr_exps = int(args[1])
            timestamp = args[2]

            if timestamp not in [&#39;created&#39;, &#39;finished&#39;]:
                msg = &#39;choose created or finished as timestamp&#39;
            else:
                leaderboard = self.neptune_project.get_leaderboard()
                leaderboard[timestamp] = pd.to_datetime(leaderboard[timestamp])
                leaderboard.sort_values(timestamp, ascending=False, inplace=True)
                ids = leaderboard[&#39;id&#39;].tolist()[:nr_exps]
                ids = [&#39;id&#39;] + ids
                msg = &#39;\n&#39;.join(ids)

        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _experiments_best(self, bot, update, args):
        if len(args) != 3:
            msg = [&#39;message should have a format:&#39;,
                   &#39;/experiments best METRIC NR_EXPS&#39;,
                   &#39;for example:&#39;,
                   &#39;/experiments best log_loss 3&#39;]
            msg = &#39;\n&#39;.join(msg)
        else:
            metric_name = args[1]
            metric_column = &#39;channel_&#39; + metric_name
            nr_exps = int(args[2])

            leaderboard = self.neptune_project.get_leaderboard()
            scores = leaderboard.sort_values([metric_column], ascending=False)[[&#39;id&#39;, metric_column]]

            msg = &#39;id | {}\n&#39;.format(metric_name)
            for idx, metric in scores.values[:nr_exps]:
                msg = msg + &#39;{} | {}\n&#39;.format(idx, metric)

        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _experiments_state(self, bot, update, args):
        if len(args) != 3:
            msg = [&#39;message should have a format:&#39;,
                   &#39;/experiments state STATE NR_EXPS&#39;,
                   &#39;for example:&#39;,
                   &#39;/experiments state running 4&#39;]
            msg = &#39;\n&#39;.join(msg)
        else:
            state = args[1]
            nr_exps = int(args[2])
            leaderboard = self.neptune_project.get_leaderboard(state=state)
            leaderboard[&#39;created&#39;] = pd.to_datetime(leaderboard[&#39;created&#39;])
            leaderboard.sort_values(&#39;created&#39;, ascending=False, inplace=True)
            ids = leaderboard[&#39;id&#39;].tolist()[:nr_exps]
            ids = [&#39;id&#39;] + ids
            msg = &#39;\n&#39;.join(ids)
        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _experiments_help(self, bot, update):
        msg = &#34;&#34;&#34;Available options are:\n
        /experiments last NR_EXPS
        /experiments best METRIC_NAME NR_EXPS(optional)
        /experiments state STATE NR_EXPS(optional)
        &#34;&#34;&#34;
        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _experiment_link(self, bot, update, args):
        if len(args) != 2:
            msg = [&#39;message should have a format:&#39;,
                   &#39;/experiment link SHORT_ID&#39;,
                   &#39;for example:&#39;,
                   &#39;/experiment link NEP-508&#39;]
            msg = &#39;\n&#39;.join(msg)
        else:
            short_id = args[1]
            namespace, project = self.project_name.split(&#39;/&#39;)

            msg = &#39;https://ui.neptune.ai/o/{}/org/{}/e/{}/details&#39;.format(namespace, project, short_id)
        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _experiment_plot(self, bot, update, args):
        if len(args) &lt; 3:
            msg = [&#39;message should have a format:&#39;,
                   &#39;/experiment plot SHORT_ID METRIC_NAME OTHER_METRIC_NAME&#39;,
                   &#39;for example:&#39;,
                   &#39;/experiment plot NEP-508 train_loss valid_loss&#39;]
            msg = &#39;\n&#39;.join(msg)
            bot.send_message(chat_id=update.message.chat_id, text=msg)
        else:
            short_id = args[1]
            if len(args) == 2:
                metric_names = [args[2]]
            else:
                metric_names = args[2:]

            experiment = self.neptune_project.get_experiments(id=short_id)[0]
            data = experiment.get_numeric_channels_values(*metric_names)

            fig = plt.figure()
            for channel_name in data.columns:
                if channel_name != &#39;x&#39;:
                    plt.plot(&#39;x&#39;, channel_name, data=data,
                             marker=&#39;&#39;, linewidth=2, label=channel_name)
            plt.legend()

            buffer = BytesIO()
            fig.savefig(buffer, format=&#39;png&#39;)
            buffer.seek(0)
            update.message.reply_photo(buffer)

    def _experiment_help(self, bot, update):
        msg = &#34;&#34;&#34;Available options are:\n
        /experiment link SHORT_ID
        /experiments plot SHORT_ID METRIC_NAME (OTHER_METRIC_NAME) 
        &#34;&#34;&#34;
        bot.send_message(chat_id=update.message.chat_id, text=msg)

    def _no_project_selected(self, bot, update):
        msg = [&#34;You haven&#39;t selected your project.&#34;,
               &#34;Do so by running:\n&#34;
               &#34;/project select NAMESPACE/PROJECT_NAME&#34;,
               &#34;For example:&#34;,
               &#34;/project select neptune-ai/neptune-examples&#34;]
        msg = &#39;\n&#39;.join(msg)
        bot.send_message(chat_id=update.message.chat_id, text=msg)</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="neptunecontrib.bots.telegram_bot.TelegramBot.experiment"><code class="name flex">
<span>def <span class="ident">experiment</span></span>(<span>self, bot, update, args)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def experiment(self, bot, update, args):
    if not self.neptune_project:
        self._no_project_selected(bot, update)
    else:
        if args:
            if args[0] == &#39;link&#39;:
                self._experiment_link(bot, update, args)
            elif args[0] == &#39;plot&#39;:
                self._experiment_plot(bot, update, args)
            else:
                self._experiment_help(bot, update)
        else:
            self._experiment_help(bot, update)</code></pre>
</details>
</dd>
<dt id="neptunecontrib.bots.telegram_bot.TelegramBot.experiments"><code class="name flex">
<span>def <span class="ident">experiments</span></span>(<span>self, bot, update, args)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def experiments(self, bot, update, args):
    if not self.neptune_project:
        self._no_project_selected(bot, update)
    else:
        if args:
            if args[0] == &#39;last&#39;:
                self._experiments_last(bot, update, args)
            elif args[0] == &#39;best&#39;:
                self._experiments_best(bot, update, args)
            elif args[0] == &#39;state&#39;:
                self._experiments_state(bot, update, args)
            else:
                self._experiments_help(bot, update)
        else:
            self._experiments_help(bot, update)</code></pre>
</details>
</dd>
<dt id="neptunecontrib.bots.telegram_bot.TelegramBot.project"><code class="name flex">
<span>def <span class="ident">project</span></span>(<span>self, bot, update, args)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def project(self, bot, update, args):
    if args:
        if args[0] == &#39;select&#39;:
            self._project_select(bot, update, args)
        elif args[0] == &#39;list&#39;:
            self._project_list(bot, update, args)
        else:
            self._project_help(bot, update)
    else:
        self._project_help(bot, update)</code></pre>
</details>
</dd>
<dt id="neptunecontrib.bots.telegram_bot.TelegramBot.run"><code class="name flex">
<span>def <span class="ident">run</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def run(self):
    self.updater.start_polling()</code></pre>
</details>
</dd>
<dt id="neptunecontrib.bots.telegram_bot.TelegramBot.unknown"><code class="name flex">
<span>def <span class="ident">unknown</span></span>(<span>self, bot, update)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def unknown(self, bot, update):
    bot.send_message(chat_id=update.message.chat_id,
                     text=&#34;Sorry, I only undestand /project, /experiments, /experiment&#34;)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="neptunecontrib.bots" href="index.html">neptunecontrib.bots</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="neptunecontrib.bots.telegram_bot.parse_args" href="#neptunecontrib.bots.telegram_bot.parse_args">parse_args</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="neptunecontrib.bots.telegram_bot.TelegramBot" href="#neptunecontrib.bots.telegram_bot.TelegramBot">TelegramBot</a></code></h4>
<ul class="">
<li><code><a title="neptunecontrib.bots.telegram_bot.TelegramBot.experiment" href="#neptunecontrib.bots.telegram_bot.TelegramBot.experiment">experiment</a></code></li>
<li><code><a title="neptunecontrib.bots.telegram_bot.TelegramBot.experiments" href="#neptunecontrib.bots.telegram_bot.TelegramBot.experiments">experiments</a></code></li>
<li><code><a title="neptunecontrib.bots.telegram_bot.TelegramBot.project" href="#neptunecontrib.bots.telegram_bot.TelegramBot.project">project</a></code></li>
<li><code><a title="neptunecontrib.bots.telegram_bot.TelegramBot.run" href="#neptunecontrib.bots.telegram_bot.TelegramBot.run">run</a></code></li>
<li><code><a title="neptunecontrib.bots.telegram_bot.TelegramBot.unknown" href="#neptunecontrib.bots.telegram_bot.TelegramBot.unknown">unknown</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.1</a>.</p>
</footer>
</body>
</html>