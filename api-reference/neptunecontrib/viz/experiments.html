<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.1" />
<title>neptunecontrib.viz.experiments API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>neptunecontrib.viz.experiments</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#
# Copyright (c) 2019, Neptune Labs Sp. z o.o.
#
# Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

import altair as alt

__all__ = [
    &#39;channel_curve_compare&#39;,
]

def channel_curve_compare(experiment_df,
                          width=800,
                          heights=(50, 400),
                          line_size=5,
                          legend_mark_size=100):
    &#34;&#34;&#34;Creates an interactive curve comparison chart for a list of experiments.

    It lets you tick or untick experiments that you want to compare by clicking on the legend (shift+click for multi),
    you can select the x range which you want to investigate by selecting it on the top chart and you
    get shown the actual values on mousehover.

    The chart is build on top of the Altair which in turn is build on top of Vega-Lite and Vega.
    That means you can use the objects produces by this script (converting it first to json by .to_json() method)
    in your html webpage without any problem.

    Args:
        experiment_df(&#39;pandas.DataFrame&#39;): Dataframe containing [&#39;id&#39;,&#39;x&#39;,&#39;CHANNEL_NAME&#39;].
            It can be obtained from a list of experiments by using the
            `neptunelib.api.concat_experiments_on_channel` function. If the len of the dataframe exceeds 5000 it will
            cause the MaxRowsError. Read the Note to learn why and how to disable it.
        width(int): width of the chart. Default is 800.
        heights(tuple): heights of the subcharts. The first value controls the top chart, the second
            controls the bottom chart. Default is (50,400).
        line_size(int): size of the lines. Default is 5.
        legend_mark_size(int): size of the marks in legend. Default is 100.

    Returns:
        `altair.Chart`: Altair chart object which will be automatically rendered in the notebook. You can
        also run the `.to_json()` method on it to convert it to the Vega-Lite json format.

    Examples:
        Instantiate a session::

            from neptunelib.api.session import Session
            session = Session()

        Fetch a project and a list of experiments::

            project = session.get_projects(&#39;neptune-ai&#39;)[&#39;neptune-ai/Salt-Detection&#39;]
            experiments = project.get_experiments(state=[&#39;aborted&#39;], owner=[&#39;neyo&#39;], min_running_time=100000)

        Construct a channel value dataframe::

            from neptunelib.api.utils import concat_experiments_on_channel
            compare_df = concat_experiments_on_channel(experiments,&#39;unet_0 epoch_val iout loss&#39;)

        Plot interactive chart in notebook::

            from neptunelib.viz.experiments import channel_curve_compare
            channel_curve_compare(compare_df)

    Note:
        Because Vega-Lite visualizations keep all the chart data in the HTML the visualizations can consume huge
        amounts of memory if not handled properly. That is why, by default the hard limit of 5000 rows is set to
        the len of dataframe. That being said, you can disable it by adding the following line in the notebook or code::

            import altair as alt
            alt.data_transformers.enable(&#39;default&#39;, max_rows=None)

    &#34;&#34;&#34;

    assert len(experiment_df.columns) == 3, &#39;Experiment dataframe should have 3 columns \
        [&#34;id&#34;,&#34;x&#34;, &#34;CHANNEL_NAME&#34;]. \
        It has {} namely {}&#39;.format(len(experiment_df.columns), experiment_df.columns)

    top_height, bottom_height = heights
    prep_cols, channel_name = _preprocess_columns(experiment_df.columns)
    experiment_df.columns = prep_cols

    nearest = alt.selection(type=&#39;single&#39;, nearest=True, on=&#39;mouseover&#39;, fields=[&#39;x&#39;], empty=&#39;none&#39;)
    interval = alt.selection(type=&#39;interval&#39;, encodings=[&#39;x&#39;])
    legend_selection = alt.selection_multi(fields=[&#39;id&#39;])

    legend = alt.Chart().mark_point(filled=True, size=legend_mark_size).encode(
        y=alt.Y(&#39;id:N&#39;),
        color=alt.condition(legend_selection, alt.Color(&#39;id:N&#39;, legend=None), alt.value(&#39;lightgray&#39;))
    ).add_selection(
        legend_selection
    )

    selectors = alt.Chart().mark_point().encode(
        x=&#39;x:Q&#39;,
        opacity=alt.value(0),
    ).add_selection(
        nearest
    )

    top_view = alt.Chart(width=width, height=top_height).mark_line(size=line_size).encode(
        x=alt.X(&#39;x:Q&#39;, title=None),
        y=alt.Y(&#39;y:Q&#39;, scale=alt.Scale(zero=False), title=None),
        color=alt.Color(&#39;id:N&#39;, legend=None),
        opacity=alt.condition(legend_selection, alt.OpacityValue(1), alt.OpacityValue(0.0))
    ).add_selection(
        interval
    )

    line = alt.Chart().mark_line(size=line_size).encode(
        x=alt.X(&#39;x:Q&#39;, title=&#39;iteration&#39;),
        y=alt.Y(&#39;y:Q&#39;, scale=alt.Scale(zero=False), title=channel_name),
        color=alt.Color(&#39;id:N&#39;, legend=None),
        opacity=alt.condition(legend_selection, alt.OpacityValue(1), alt.OpacityValue(0.0))
    )

    points = line.mark_point().encode(
        color=alt.condition(legend_selection, alt.Color(&#39;id:N&#39;, legend=None), alt.value(&#39;white&#39;)),
        opacity=alt.condition(nearest, alt.value(1), alt.value(0))
    )

    text = line.mark_text(align=&#39;left&#39;, dx=5, dy=-5).encode(
        text=alt.condition(nearest, &#39;y:Q&#39;, alt.value(&#39; &#39;)),
        opacity=alt.condition(legend_selection, alt.OpacityValue(1), alt.OpacityValue(0.0))
    )

    rules = alt.Chart().mark_rule(color=&#39;gray&#39;).encode(
        x=&#39;x:Q&#39;,
    ).transform_filter(
        nearest
    )

    bottom_view = alt.layer(line, selectors, points, rules, text,
                            width=width, height=bottom_height
                           ).transform_filter(interval)

    combined = alt.hconcat(alt.vconcat(top_view, bottom_view), legend, data=experiment_df)
    return combined


def _preprocess_columns(columns):
    channel_name = _get_channel_name(columns)
    prep_cols = []
    for col in columns:
        if col == channel_name:
            col = &#39;y&#39;
        prep_cols.append(col)
    return prep_cols, channel_name


def _get_channel_name(columns):
    return [col for col in columns if col not in [&#39;id&#39;, &#39;x&#39;]][0]</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="neptunecontrib.viz.experiments.channel_curve_compare"><code class="name flex">
<span>def <span class="ident">channel_curve_compare</span></span>(<span>experiment_df, width=800, heights=(50, 400), line_size=5, legend_mark_size=100)</span>
</code></dt>
<dd>
<div class="desc"><p>Creates an interactive curve comparison chart for a list of experiments.</p>
<p>It lets you tick or untick experiments that you want to compare by clicking on the legend (shift+click for multi),
you can select the x range which you want to investigate by selecting it on the top chart and you
get shown the actual values on mousehover.</p>
<p>The chart is build on top of the Altair which in turn is build on top of Vega-Lite and Vega.
That means you can use the objects produces by this script (converting it first to json by .to_json() method)
in your html webpage without any problem.</p>
<h2 id="args">Args</h2>
<p>experiment_df('pandas.DataFrame'): Dataframe containing ['id','x','CHANNEL_NAME'].
It can be obtained from a list of experiments by using the
<code>neptunelib.api.concat_experiments_on_channel</code> function. If the len of the dataframe exceeds 5000 it will
cause the MaxRowsError. Read the Note to learn why and how to disable it.
width(int): width of the chart. Default is 800.
heights(tuple): heights of the subcharts. The first value controls the top chart, the second
controls the bottom chart. Default is (50,400).
line_size(int): size of the lines. Default is 5.
legend_mark_size(int): size of the marks in legend. Default is 100.</p>
<h2 id="returns">Returns</h2>
<p><code>altair.Chart</code>: Altair chart object which will be automatically rendered in the notebook. You can
also run the <code>.to_json()</code> method on it to convert it to the Vega-Lite json format.</p>
<h2 id="examples">Examples</h2>
<p>Instantiate a session::</p>
<pre><code>from neptunelib.api.session import Session
session = Session()
</code></pre>
<p>Fetch a project and a list of experiments::</p>
<pre><code>project = session.get_projects('neptune-ai')['neptune-ai/Salt-Detection']
experiments = project.get_experiments(state=['aborted'], owner=['neyo'], min_running_time=100000)
</code></pre>
<p>Construct a channel value dataframe::</p>
<pre><code>from neptunelib.api.utils import concat_experiments_on_channel
compare_df = concat_experiments_on_channel(experiments,'unet_0 epoch_val iout loss')
</code></pre>
<p>Plot interactive chart in notebook::</p>
<pre><code>from neptunelib.viz.experiments import channel_curve_compare
channel_curve_compare(compare_df)
</code></pre>
<h2 id="note">Note</h2>
<p>Because Vega-Lite visualizations keep all the chart data in the HTML the visualizations can consume huge
amounts of memory if not handled properly. That is why, by default the hard limit of 5000 rows is set to
the len of dataframe. That being said, you can disable it by adding the following line in the notebook or code::</p>
<pre><code>import altair as alt
alt.data_transformers.enable('default', max_rows=None)
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def channel_curve_compare(experiment_df,
                          width=800,
                          heights=(50, 400),
                          line_size=5,
                          legend_mark_size=100):
    &#34;&#34;&#34;Creates an interactive curve comparison chart for a list of experiments.

    It lets you tick or untick experiments that you want to compare by clicking on the legend (shift+click for multi),
    you can select the x range which you want to investigate by selecting it on the top chart and you
    get shown the actual values on mousehover.

    The chart is build on top of the Altair which in turn is build on top of Vega-Lite and Vega.
    That means you can use the objects produces by this script (converting it first to json by .to_json() method)
    in your html webpage without any problem.

    Args:
        experiment_df(&#39;pandas.DataFrame&#39;): Dataframe containing [&#39;id&#39;,&#39;x&#39;,&#39;CHANNEL_NAME&#39;].
            It can be obtained from a list of experiments by using the
            `neptunelib.api.concat_experiments_on_channel` function. If the len of the dataframe exceeds 5000 it will
            cause the MaxRowsError. Read the Note to learn why and how to disable it.
        width(int): width of the chart. Default is 800.
        heights(tuple): heights of the subcharts. The first value controls the top chart, the second
            controls the bottom chart. Default is (50,400).
        line_size(int): size of the lines. Default is 5.
        legend_mark_size(int): size of the marks in legend. Default is 100.

    Returns:
        `altair.Chart`: Altair chart object which will be automatically rendered in the notebook. You can
        also run the `.to_json()` method on it to convert it to the Vega-Lite json format.

    Examples:
        Instantiate a session::

            from neptunelib.api.session import Session
            session = Session()

        Fetch a project and a list of experiments::

            project = session.get_projects(&#39;neptune-ai&#39;)[&#39;neptune-ai/Salt-Detection&#39;]
            experiments = project.get_experiments(state=[&#39;aborted&#39;], owner=[&#39;neyo&#39;], min_running_time=100000)

        Construct a channel value dataframe::

            from neptunelib.api.utils import concat_experiments_on_channel
            compare_df = concat_experiments_on_channel(experiments,&#39;unet_0 epoch_val iout loss&#39;)

        Plot interactive chart in notebook::

            from neptunelib.viz.experiments import channel_curve_compare
            channel_curve_compare(compare_df)

    Note:
        Because Vega-Lite visualizations keep all the chart data in the HTML the visualizations can consume huge
        amounts of memory if not handled properly. That is why, by default the hard limit of 5000 rows is set to
        the len of dataframe. That being said, you can disable it by adding the following line in the notebook or code::

            import altair as alt
            alt.data_transformers.enable(&#39;default&#39;, max_rows=None)

    &#34;&#34;&#34;

    assert len(experiment_df.columns) == 3, &#39;Experiment dataframe should have 3 columns \
        [&#34;id&#34;,&#34;x&#34;, &#34;CHANNEL_NAME&#34;]. \
        It has {} namely {}&#39;.format(len(experiment_df.columns), experiment_df.columns)

    top_height, bottom_height = heights
    prep_cols, channel_name = _preprocess_columns(experiment_df.columns)
    experiment_df.columns = prep_cols

    nearest = alt.selection(type=&#39;single&#39;, nearest=True, on=&#39;mouseover&#39;, fields=[&#39;x&#39;], empty=&#39;none&#39;)
    interval = alt.selection(type=&#39;interval&#39;, encodings=[&#39;x&#39;])
    legend_selection = alt.selection_multi(fields=[&#39;id&#39;])

    legend = alt.Chart().mark_point(filled=True, size=legend_mark_size).encode(
        y=alt.Y(&#39;id:N&#39;),
        color=alt.condition(legend_selection, alt.Color(&#39;id:N&#39;, legend=None), alt.value(&#39;lightgray&#39;))
    ).add_selection(
        legend_selection
    )

    selectors = alt.Chart().mark_point().encode(
        x=&#39;x:Q&#39;,
        opacity=alt.value(0),
    ).add_selection(
        nearest
    )

    top_view = alt.Chart(width=width, height=top_height).mark_line(size=line_size).encode(
        x=alt.X(&#39;x:Q&#39;, title=None),
        y=alt.Y(&#39;y:Q&#39;, scale=alt.Scale(zero=False), title=None),
        color=alt.Color(&#39;id:N&#39;, legend=None),
        opacity=alt.condition(legend_selection, alt.OpacityValue(1), alt.OpacityValue(0.0))
    ).add_selection(
        interval
    )

    line = alt.Chart().mark_line(size=line_size).encode(
        x=alt.X(&#39;x:Q&#39;, title=&#39;iteration&#39;),
        y=alt.Y(&#39;y:Q&#39;, scale=alt.Scale(zero=False), title=channel_name),
        color=alt.Color(&#39;id:N&#39;, legend=None),
        opacity=alt.condition(legend_selection, alt.OpacityValue(1), alt.OpacityValue(0.0))
    )

    points = line.mark_point().encode(
        color=alt.condition(legend_selection, alt.Color(&#39;id:N&#39;, legend=None), alt.value(&#39;white&#39;)),
        opacity=alt.condition(nearest, alt.value(1), alt.value(0))
    )

    text = line.mark_text(align=&#39;left&#39;, dx=5, dy=-5).encode(
        text=alt.condition(nearest, &#39;y:Q&#39;, alt.value(&#39; &#39;)),
        opacity=alt.condition(legend_selection, alt.OpacityValue(1), alt.OpacityValue(0.0))
    )

    rules = alt.Chart().mark_rule(color=&#39;gray&#39;).encode(
        x=&#39;x:Q&#39;,
    ).transform_filter(
        nearest
    )

    bottom_view = alt.layer(line, selectors, points, rules, text,
                            width=width, height=bottom_height
                           ).transform_filter(interval)

    combined = alt.hconcat(alt.vconcat(top_view, bottom_view), legend, data=experiment_df)
    return combined</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="neptunecontrib.viz" href="index.html">neptunecontrib.viz</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="neptunecontrib.viz.experiments.channel_curve_compare" href="#neptunecontrib.viz.experiments.channel_curve_compare">channel_curve_compare</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.1</a>.</p>
</footer>
</body>
</html>