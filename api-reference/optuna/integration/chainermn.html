<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.1" />
<title>optuna.integration.chainermn API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>optuna.integration.chainermn</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from datetime import datetime
from typing import Any
from typing import Callable
from typing import Dict
from typing import Optional
from typing import Sequence
from typing import Tuple
from typing import Type
import warnings

from optuna._imports import try_import
from optuna.distributions import BaseDistribution
from optuna.distributions import CategoricalChoiceType
from optuna.storages import InMemoryStorage
from optuna.storages import RDBStorage
from optuna.study import Study
from optuna.trial import BaseTrial
from optuna.trial import Trial
from optuna import TrialPruned

with try_import() as _imports:
    from chainermn.communicators.communicator_base import CommunicatorBase  # NOQA


class _ChainerMNObjectiveFunc(object):
    &#34;&#34;&#34;A wrapper of an objective function to incorporate Optuna with ChainerMN.

    Note that this class is not supposed to be used by library users.

    Args:
        func:
            A callable that implements objective function.
        comm:
            A `ChainerMN communicator &lt;https://docs.chainer.org/en/stable/chainermn/reference/
            index.html#communicators&gt;`_.
    &#34;&#34;&#34;

    def __init__(
        self,
        func: Callable[[&#34;ChainerMNTrial&#34;, &#34;CommunicatorBase&#34;], float],
        comm: &#34;CommunicatorBase&#34;,
    ) -&gt; None:

        self.comm = comm
        self.objective = func

    def __call__(self, trial: Trial) -&gt; float:

        self.comm.mpi_comm.bcast(True)
        return self.objective(ChainerMNTrial(trial, self.comm), self.comm)


class ChainerMNStudy(object):
    &#34;&#34;&#34;A wrapper of :class:`~optuna.study.Study` to incorporate Optuna with ChainerMN.

    .. seealso::
        :class:`~optuna.integration.chainermn.ChainerMNStudy` provides the same interface as
        :class:`~optuna.study.Study`. Please refer to :class:`optuna.study.Study` for further
        details.

    See `the example &lt;https://github.com/optuna/optuna/blob/master/
    examples/pruning/chainermn_integration.py&gt;`__
    if you want to optimize an objective function that trains neural network
    written with ChainerMN.

    Args:
        study:
            A :class:`~optuna.study.Study` object.
        comm:
            A `ChainerMN communicator &lt;https://docs.chainer.org/en/stable/chainermn/reference/
            index.html#communicators&gt;`_.
    &#34;&#34;&#34;

    def __init__(self, study: Study, comm: &#34;CommunicatorBase&#34;) -&gt; None:

        _imports.check()

        if isinstance(study._storage, InMemoryStorage):
            raise ValueError(&#34;ChainerMN integration is not available with InMemoryStorage.&#34;)

        if isinstance(study._storage, RDBStorage):
            if study._storage.engine.dialect.name == &#34;sqlite&#34;:
                warnings.warn(
                    &#34;SQLite may cause synchronization problems when used with &#34;
                    &#34;ChainerMN integration. Please use other DBs like PostgreSQL.&#34;
                )

        study_names = comm.mpi_comm.allgather(study.study_name)
        if len(set(study_names)) != 1:
            raise ValueError(&#34;Please make sure an identical study name is shared among workers.&#34;)

        super(ChainerMNStudy, self).__setattr__(&#34;delegate&#34;, study)
        super(ChainerMNStudy, self).__setattr__(&#34;comm&#34;, comm)

    def optimize(
        self,
        func: Callable[[&#34;ChainerMNTrial&#34;, &#34;CommunicatorBase&#34;], float],
        n_trials: Optional[int] = None,
        timeout: Optional[float] = None,
        catch: Tuple[Type[Exception], ...] = (),
    ) -&gt; None:
        &#34;&#34;&#34;Optimize an objective function.

        This method provides the same interface as :func:`optuna.study.Study.optimize` except
        the absence of ``n_jobs`` argument.
        &#34;&#34;&#34;

        if self.comm.rank == 0:
            func_mn = _ChainerMNObjectiveFunc(func, self.comm)
            try:
                self.delegate.optimize(func_mn, n_trials=n_trials, timeout=timeout, catch=catch)
            finally:
                self.comm.mpi_comm.bcast(False)
        else:
            has_next_trial = self.comm.mpi_comm.bcast(None)
            while True:
                if not has_next_trial:
                    break
                try:
                    func(ChainerMNTrial(None, self.comm), self.comm)

                    # We assume that if a node raises an exception,
                    # all other nodes will do the same.
                    #
                    # The responsibility to handle acceptable exceptions (i.e., `TrialPruned` and
                    # `catch`) is in the rank-0 node, so other nodes simply ignore them.
                except TrialPruned:
                    pass
                except catch:
                    pass
                finally:
                    has_next_trial = self.comm.mpi_comm.bcast(None)

    def __getattr__(self, attr_name: str) -&gt; Any:

        return getattr(self.delegate, attr_name)

    def __setattr__(self, attr_name: str, value: Any) -&gt; None:

        setattr(self.delegate, attr_name, value)


class ChainerMNTrial(BaseTrial):
    &#34;&#34;&#34;A wrapper of :class:`~optuna.trial.Trial` to incorporate Optuna with ChainerMN.

    .. seealso::
        :class:`~optuna.integration.chainermn.ChainerMNTrial` provides the same interface as
        :class:`~optuna.trial.Trial`. Please refer to :class:`optuna.trial.Trial` for further
        details.

    Args:
        trial:
            A :class:`~optuna.trial.Trial` object if the caller is rank0 worker,
            :obj:`None` otherwise.
        comm:
            A `ChainerMN communicator &lt;https://docs.chainer.org/en/stable/chainermn/reference/
            index.html#communicators&gt;`_.
    &#34;&#34;&#34;

    def __init__(self, trial: Optional[Trial], comm: &#34;CommunicatorBase&#34;) -&gt; None:

        self.delegate = trial
        self.comm = comm

    def suggest_float(
        self,
        name: str,
        low: float,
        high: float,
        *,
        step: Optional[float] = None,
        log: bool = False
    ) -&gt; float:
        def func() -&gt; float:
            assert self.delegate is not None
            return self.delegate.suggest_float(name, low, high, log=log, step=step)

        return self._call_with_mpi(func)

    def suggest_uniform(self, name: str, low: float, high: float) -&gt; float:
        def func() -&gt; float:

            assert self.delegate is not None
            return self.delegate.suggest_uniform(name, low, high)

        return self._call_with_mpi(func)

    def suggest_loguniform(self, name: str, low: float, high: float) -&gt; float:
        def func() -&gt; float:

            assert self.delegate is not None
            return self.delegate.suggest_loguniform(name, low, high)

        return self._call_with_mpi(func)

    def suggest_discrete_uniform(self, name: str, low: float, high: float, q: float) -&gt; float:
        def func() -&gt; float:

            assert self.delegate is not None
            return self.delegate.suggest_discrete_uniform(name, low, high, q)

        return self._call_with_mpi(func)

    def suggest_int(self, name: str, low: int, high: int, step: int = 1, log: bool = False) -&gt; int:
        def func() -&gt; int:

            assert self.delegate is not None
            return self.delegate.suggest_int(name, low, high, step=step, log=log)

        return self._call_with_mpi(func)

    def suggest_categorical(self, name: str, choices: Sequence[CategoricalChoiceType]) -&gt; Any:
        def func() -&gt; CategoricalChoiceType:

            assert self.delegate is not None
            return self.delegate.suggest_categorical(name, choices)

        return self._call_with_mpi(func)

    def report(self, value: float, step: int) -&gt; None:

        if self.comm.rank == 0:
            assert self.delegate is not None
            self.delegate.report(value, step)
        self.comm.mpi_comm.barrier()

    def should_prune(self) -&gt; bool:
        def func() -&gt; bool:

            assert self.delegate is not None
            return self.delegate.should_prune()

        return self._call_with_mpi(func)

    def set_user_attr(self, key: str, value: Any) -&gt; None:

        if self.comm.rank == 0:
            assert self.delegate is not None
            self.delegate.set_user_attr(key, value)
        self.comm.mpi_comm.barrier()

    def set_system_attr(self, key: str, value: Any) -&gt; None:

        if self.comm.rank == 0:
            assert self.delegate is not None
            self.delegate.set_system_attr(key, value)
        self.comm.mpi_comm.barrier()

    @property
    def number(self) -&gt; int:
        def func() -&gt; int:

            assert self.delegate is not None
            return self.delegate.number

        return self._call_with_mpi(func)

    @property
    def _trial_id(self) -&gt; int:
        def func() -&gt; int:

            assert self.delegate is not None
            return self.delegate._trial_id

        return self._call_with_mpi(func)

    @property
    def params(self) -&gt; Dict[str, Any]:
        def func() -&gt; Dict[str, Any]:

            assert self.delegate is not None
            return self.delegate.params

        return self._call_with_mpi(func)

    @property
    def distributions(self) -&gt; Dict[str, BaseDistribution]:
        def func() -&gt; Dict[str, BaseDistribution]:

            assert self.delegate is not None
            return self.delegate.distributions

        return self._call_with_mpi(func)

    @property
    def user_attrs(self) -&gt; Dict[str, Any]:
        def func() -&gt; Dict[str, Any]:

            assert self.delegate is not None
            return self.delegate.user_attrs

        return self._call_with_mpi(func)

    @property
    def system_attrs(self) -&gt; Dict[str, Any]:
        def func() -&gt; Dict[str, Any]:

            assert self.delegate is not None
            return self.delegate.system_attrs

        return self._call_with_mpi(func)

    @property
    def datetime_start(self) -&gt; Optional[datetime]:
        def func() -&gt; Optional[datetime]:

            assert self.delegate is not None
            return self.delegate.datetime_start

        return self._call_with_mpi(func)

    def _call_with_mpi(self, func: Callable) -&gt; Any:

        if self.comm.rank == 0:
            try:
                result = func()
                self.comm.mpi_comm.bcast(result)
                return result
            except Exception as e:
                self.comm.mpi_comm.bcast(e)
                raise
        else:
            result = self.comm.mpi_comm.bcast(None)
            if isinstance(result, Exception):
                raise result
            return result</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="optuna.integration.chainermn.ChainerMNStudy"><code class="flex name class">
<span>class <span class="ident">ChainerMNStudy</span></span>
<span>(</span><span>study: <a title="optuna.study.Study" href="../study.html#optuna.study.Study">Study</a>, comm: CommunicatorBase)</span>
</code></dt>
<dd>
<div class="desc"><p>A wrapper of :class:<code>~optuna.study.Study</code> to incorporate Optuna with ChainerMN.</p>
<div class="admonition seealso">
<p class="admonition-title">Seealso</p>
<p>:class:<code>~optuna.integration.chainermn.ChainerMNStudy</code> provides the same interface as
:class:<code>~optuna.study.Study</code>. Please refer to :class:<code><a title="optuna.study.Study" href="../study.html#optuna.study.Study">Study</a></code> for further
details.</p>
</div>
<p>See <code>the example &lt;https://github.com/optuna/optuna/blob/master/
examples/pruning/chainermn_integration.py&gt;</code>__
if you want to optimize an objective function that trains neural network
written with ChainerMN.</p>
<h2 id="args">Args</h2>
<p>study:
A :class:<code>~optuna.study.Study</code> object.
comm:
A <code>ChainerMN communicator &lt;https://docs.chainer.org/en/stable/chainermn/reference/
index.html#communicators&gt;</code>_.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ChainerMNStudy(object):
    &#34;&#34;&#34;A wrapper of :class:`~optuna.study.Study` to incorporate Optuna with ChainerMN.

    .. seealso::
        :class:`~optuna.integration.chainermn.ChainerMNStudy` provides the same interface as
        :class:`~optuna.study.Study`. Please refer to :class:`optuna.study.Study` for further
        details.

    See `the example &lt;https://github.com/optuna/optuna/blob/master/
    examples/pruning/chainermn_integration.py&gt;`__
    if you want to optimize an objective function that trains neural network
    written with ChainerMN.

    Args:
        study:
            A :class:`~optuna.study.Study` object.
        comm:
            A `ChainerMN communicator &lt;https://docs.chainer.org/en/stable/chainermn/reference/
            index.html#communicators&gt;`_.
    &#34;&#34;&#34;

    def __init__(self, study: Study, comm: &#34;CommunicatorBase&#34;) -&gt; None:

        _imports.check()

        if isinstance(study._storage, InMemoryStorage):
            raise ValueError(&#34;ChainerMN integration is not available with InMemoryStorage.&#34;)

        if isinstance(study._storage, RDBStorage):
            if study._storage.engine.dialect.name == &#34;sqlite&#34;:
                warnings.warn(
                    &#34;SQLite may cause synchronization problems when used with &#34;
                    &#34;ChainerMN integration. Please use other DBs like PostgreSQL.&#34;
                )

        study_names = comm.mpi_comm.allgather(study.study_name)
        if len(set(study_names)) != 1:
            raise ValueError(&#34;Please make sure an identical study name is shared among workers.&#34;)

        super(ChainerMNStudy, self).__setattr__(&#34;delegate&#34;, study)
        super(ChainerMNStudy, self).__setattr__(&#34;comm&#34;, comm)

    def optimize(
        self,
        func: Callable[[&#34;ChainerMNTrial&#34;, &#34;CommunicatorBase&#34;], float],
        n_trials: Optional[int] = None,
        timeout: Optional[float] = None,
        catch: Tuple[Type[Exception], ...] = (),
    ) -&gt; None:
        &#34;&#34;&#34;Optimize an objective function.

        This method provides the same interface as :func:`optuna.study.Study.optimize` except
        the absence of ``n_jobs`` argument.
        &#34;&#34;&#34;

        if self.comm.rank == 0:
            func_mn = _ChainerMNObjectiveFunc(func, self.comm)
            try:
                self.delegate.optimize(func_mn, n_trials=n_trials, timeout=timeout, catch=catch)
            finally:
                self.comm.mpi_comm.bcast(False)
        else:
            has_next_trial = self.comm.mpi_comm.bcast(None)
            while True:
                if not has_next_trial:
                    break
                try:
                    func(ChainerMNTrial(None, self.comm), self.comm)

                    # We assume that if a node raises an exception,
                    # all other nodes will do the same.
                    #
                    # The responsibility to handle acceptable exceptions (i.e., `TrialPruned` and
                    # `catch`) is in the rank-0 node, so other nodes simply ignore them.
                except TrialPruned:
                    pass
                except catch:
                    pass
                finally:
                    has_next_trial = self.comm.mpi_comm.bcast(None)

    def __getattr__(self, attr_name: str) -&gt; Any:

        return getattr(self.delegate, attr_name)

    def __setattr__(self, attr_name: str, value: Any) -&gt; None:

        setattr(self.delegate, attr_name, value)</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="optuna.integration.chainermn.ChainerMNStudy.optimize"><code class="name flex">
<span>def <span class="ident">optimize</span></span>(<span>self, func: Callable[[_ForwardRef('<a title="optuna.integration.chainermn.ChainerMNTrial" href="#optuna.integration.chainermn.ChainerMNTrial">ChainerMNTrial</a>'), _ForwardRef('CommunicatorBase')], float], n_trials: Union[int, NoneType] = None, timeout: Union[float, NoneType] = None, catch: Tuple[Type[Exception], ...] = ())</span>
</code></dt>
<dd>
<div class="desc"><p>Optimize an objective function.</p>
<p>This method provides the same interface as :func:<code><a title="optuna.study.Study.optimize" href="../study.html#optuna.study.Study.optimize">Study.optimize()</a></code> except
the absence of <code>n_jobs</code> argument.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def optimize(
    self,
    func: Callable[[&#34;ChainerMNTrial&#34;, &#34;CommunicatorBase&#34;], float],
    n_trials: Optional[int] = None,
    timeout: Optional[float] = None,
    catch: Tuple[Type[Exception], ...] = (),
) -&gt; None:
    &#34;&#34;&#34;Optimize an objective function.

    This method provides the same interface as :func:`optuna.study.Study.optimize` except
    the absence of ``n_jobs`` argument.
    &#34;&#34;&#34;

    if self.comm.rank == 0:
        func_mn = _ChainerMNObjectiveFunc(func, self.comm)
        try:
            self.delegate.optimize(func_mn, n_trials=n_trials, timeout=timeout, catch=catch)
        finally:
            self.comm.mpi_comm.bcast(False)
    else:
        has_next_trial = self.comm.mpi_comm.bcast(None)
        while True:
            if not has_next_trial:
                break
            try:
                func(ChainerMNTrial(None, self.comm), self.comm)

                # We assume that if a node raises an exception,
                # all other nodes will do the same.
                #
                # The responsibility to handle acceptable exceptions (i.e., `TrialPruned` and
                # `catch`) is in the rank-0 node, so other nodes simply ignore them.
            except TrialPruned:
                pass
            except catch:
                pass
            finally:
                has_next_trial = self.comm.mpi_comm.bcast(None)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="optuna.integration.chainermn.ChainerMNTrial"><code class="flex name class">
<span>class <span class="ident">ChainerMNTrial</span></span>
<span>(</span><span>trial: Union[optuna.trial._trial.Trial, NoneType], comm: CommunicatorBase)</span>
</code></dt>
<dd>
<div class="desc"><p>A wrapper of :class:<code>~optuna.trial.Trial</code> to incorporate Optuna with ChainerMN.</p>
<div class="admonition seealso">
<p class="admonition-title">Seealso</p>
<p>:class:<code>~optuna.integration.chainermn.ChainerMNTrial</code> provides the same interface as
:class:<code>~optuna.trial.Trial</code>. Please refer to :class:<code>optuna.trial.Trial</code> for further
details.</p>
</div>
<h2 id="args">Args</h2>
<p>trial:
A :class:<code>~optuna.trial.Trial</code> object if the caller is rank0 worker,
:obj:<code>None</code> otherwise.
comm:
A <code>ChainerMN communicator &lt;https://docs.chainer.org/en/stable/chainermn/reference/
index.html#communicators&gt;</code>_.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ChainerMNTrial(BaseTrial):
    &#34;&#34;&#34;A wrapper of :class:`~optuna.trial.Trial` to incorporate Optuna with ChainerMN.

    .. seealso::
        :class:`~optuna.integration.chainermn.ChainerMNTrial` provides the same interface as
        :class:`~optuna.trial.Trial`. Please refer to :class:`optuna.trial.Trial` for further
        details.

    Args:
        trial:
            A :class:`~optuna.trial.Trial` object if the caller is rank0 worker,
            :obj:`None` otherwise.
        comm:
            A `ChainerMN communicator &lt;https://docs.chainer.org/en/stable/chainermn/reference/
            index.html#communicators&gt;`_.
    &#34;&#34;&#34;

    def __init__(self, trial: Optional[Trial], comm: &#34;CommunicatorBase&#34;) -&gt; None:

        self.delegate = trial
        self.comm = comm

    def suggest_float(
        self,
        name: str,
        low: float,
        high: float,
        *,
        step: Optional[float] = None,
        log: bool = False
    ) -&gt; float:
        def func() -&gt; float:
            assert self.delegate is not None
            return self.delegate.suggest_float(name, low, high, log=log, step=step)

        return self._call_with_mpi(func)

    def suggest_uniform(self, name: str, low: float, high: float) -&gt; float:
        def func() -&gt; float:

            assert self.delegate is not None
            return self.delegate.suggest_uniform(name, low, high)

        return self._call_with_mpi(func)

    def suggest_loguniform(self, name: str, low: float, high: float) -&gt; float:
        def func() -&gt; float:

            assert self.delegate is not None
            return self.delegate.suggest_loguniform(name, low, high)

        return self._call_with_mpi(func)

    def suggest_discrete_uniform(self, name: str, low: float, high: float, q: float) -&gt; float:
        def func() -&gt; float:

            assert self.delegate is not None
            return self.delegate.suggest_discrete_uniform(name, low, high, q)

        return self._call_with_mpi(func)

    def suggest_int(self, name: str, low: int, high: int, step: int = 1, log: bool = False) -&gt; int:
        def func() -&gt; int:

            assert self.delegate is not None
            return self.delegate.suggest_int(name, low, high, step=step, log=log)

        return self._call_with_mpi(func)

    def suggest_categorical(self, name: str, choices: Sequence[CategoricalChoiceType]) -&gt; Any:
        def func() -&gt; CategoricalChoiceType:

            assert self.delegate is not None
            return self.delegate.suggest_categorical(name, choices)

        return self._call_with_mpi(func)

    def report(self, value: float, step: int) -&gt; None:

        if self.comm.rank == 0:
            assert self.delegate is not None
            self.delegate.report(value, step)
        self.comm.mpi_comm.barrier()

    def should_prune(self) -&gt; bool:
        def func() -&gt; bool:

            assert self.delegate is not None
            return self.delegate.should_prune()

        return self._call_with_mpi(func)

    def set_user_attr(self, key: str, value: Any) -&gt; None:

        if self.comm.rank == 0:
            assert self.delegate is not None
            self.delegate.set_user_attr(key, value)
        self.comm.mpi_comm.barrier()

    def set_system_attr(self, key: str, value: Any) -&gt; None:

        if self.comm.rank == 0:
            assert self.delegate is not None
            self.delegate.set_system_attr(key, value)
        self.comm.mpi_comm.barrier()

    @property
    def number(self) -&gt; int:
        def func() -&gt; int:

            assert self.delegate is not None
            return self.delegate.number

        return self._call_with_mpi(func)

    @property
    def _trial_id(self) -&gt; int:
        def func() -&gt; int:

            assert self.delegate is not None
            return self.delegate._trial_id

        return self._call_with_mpi(func)

    @property
    def params(self) -&gt; Dict[str, Any]:
        def func() -&gt; Dict[str, Any]:

            assert self.delegate is not None
            return self.delegate.params

        return self._call_with_mpi(func)

    @property
    def distributions(self) -&gt; Dict[str, BaseDistribution]:
        def func() -&gt; Dict[str, BaseDistribution]:

            assert self.delegate is not None
            return self.delegate.distributions

        return self._call_with_mpi(func)

    @property
    def user_attrs(self) -&gt; Dict[str, Any]:
        def func() -&gt; Dict[str, Any]:

            assert self.delegate is not None
            return self.delegate.user_attrs

        return self._call_with_mpi(func)

    @property
    def system_attrs(self) -&gt; Dict[str, Any]:
        def func() -&gt; Dict[str, Any]:

            assert self.delegate is not None
            return self.delegate.system_attrs

        return self._call_with_mpi(func)

    @property
    def datetime_start(self) -&gt; Optional[datetime]:
        def func() -&gt; Optional[datetime]:

            assert self.delegate is not None
            return self.delegate.datetime_start

        return self._call_with_mpi(func)

    def _call_with_mpi(self, func: Callable) -&gt; Any:

        if self.comm.rank == 0:
            try:
                result = func()
                self.comm.mpi_comm.bcast(result)
                return result
            except Exception as e:
                self.comm.mpi_comm.bcast(e)
                raise
        else:
            result = self.comm.mpi_comm.bcast(None)
            if isinstance(result, Exception):
                raise result
            return result</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>optuna.trial._base.BaseTrial</li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="optuna.integration.chainermn.ChainerMNTrial.datetime_start"><code class="name">var <span class="ident">datetime_start</span> : Union[datetime.datetime, NoneType]</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def datetime_start(self) -&gt; Optional[datetime]:
    def func() -&gt; Optional[datetime]:

        assert self.delegate is not None
        return self.delegate.datetime_start

    return self._call_with_mpi(func)</code></pre>
</details>
</dd>
<dt id="optuna.integration.chainermn.ChainerMNTrial.distributions"><code class="name">var <span class="ident">distributions</span> : Dict[str, <a title="optuna.distributions.BaseDistribution" href="../distributions.html#optuna.distributions.BaseDistribution">BaseDistribution</a>]</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def distributions(self) -&gt; Dict[str, BaseDistribution]:
    def func() -&gt; Dict[str, BaseDistribution]:

        assert self.delegate is not None
        return self.delegate.distributions

    return self._call_with_mpi(func)</code></pre>
</details>
</dd>
<dt id="optuna.integration.chainermn.ChainerMNTrial.number"><code class="name">var <span class="ident">number</span> : int</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def number(self) -&gt; int:
    def func() -&gt; int:

        assert self.delegate is not None
        return self.delegate.number

    return self._call_with_mpi(func)</code></pre>
</details>
</dd>
<dt id="optuna.integration.chainermn.ChainerMNTrial.params"><code class="name">var <span class="ident">params</span> : Dict[str, Any]</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def params(self) -&gt; Dict[str, Any]:
    def func() -&gt; Dict[str, Any]:

        assert self.delegate is not None
        return self.delegate.params

    return self._call_with_mpi(func)</code></pre>
</details>
</dd>
<dt id="optuna.integration.chainermn.ChainerMNTrial.system_attrs"><code class="name">var <span class="ident">system_attrs</span> : Dict[str, Any]</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def system_attrs(self) -&gt; Dict[str, Any]:
    def func() -&gt; Dict[str, Any]:

        assert self.delegate is not None
        return self.delegate.system_attrs

    return self._call_with_mpi(func)</code></pre>
</details>
</dd>
<dt id="optuna.integration.chainermn.ChainerMNTrial.user_attrs"><code class="name">var <span class="ident">user_attrs</span> : Dict[str, Any]</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def user_attrs(self) -&gt; Dict[str, Any]:
    def func() -&gt; Dict[str, Any]:

        assert self.delegate is not None
        return self.delegate.user_attrs

    return self._call_with_mpi(func)</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="optuna.integration.chainermn.ChainerMNTrial.report"><code class="name flex">
<span>def <span class="ident">report</span></span>(<span>self, value: float, step: int) ‑> NoneType</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def report(self, value: float, step: int) -&gt; None:

    if self.comm.rank == 0:
        assert self.delegate is not None
        self.delegate.report(value, step)
    self.comm.mpi_comm.barrier()</code></pre>
</details>
</dd>
<dt id="optuna.integration.chainermn.ChainerMNTrial.set_system_attr"><code class="name flex">
<span>def <span class="ident">set_system_attr</span></span>(<span>self, key: str, value: Any) ‑> NoneType</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_system_attr(self, key: str, value: Any) -&gt; None:

    if self.comm.rank == 0:
        assert self.delegate is not None
        self.delegate.set_system_attr(key, value)
    self.comm.mpi_comm.barrier()</code></pre>
</details>
</dd>
<dt id="optuna.integration.chainermn.ChainerMNTrial.set_user_attr"><code class="name flex">
<span>def <span class="ident">set_user_attr</span></span>(<span>self, key: str, value: Any) ‑> NoneType</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_user_attr(self, key: str, value: Any) -&gt; None:

    if self.comm.rank == 0:
        assert self.delegate is not None
        self.delegate.set_user_attr(key, value)
    self.comm.mpi_comm.barrier()</code></pre>
</details>
</dd>
<dt id="optuna.integration.chainermn.ChainerMNTrial.should_prune"><code class="name flex">
<span>def <span class="ident">should_prune</span></span>(<span>self) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def should_prune(self) -&gt; bool:
    def func() -&gt; bool:

        assert self.delegate is not None
        return self.delegate.should_prune()

    return self._call_with_mpi(func)</code></pre>
</details>
</dd>
<dt id="optuna.integration.chainermn.ChainerMNTrial.suggest_categorical"><code class="name flex">
<span>def <span class="ident">suggest_categorical</span></span>(<span>self, name: str, choices: Sequence[Union[str, float, int, NoneType]]) ‑> Any</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def suggest_categorical(self, name: str, choices: Sequence[CategoricalChoiceType]) -&gt; Any:
    def func() -&gt; CategoricalChoiceType:

        assert self.delegate is not None
        return self.delegate.suggest_categorical(name, choices)

    return self._call_with_mpi(func)</code></pre>
</details>
</dd>
<dt id="optuna.integration.chainermn.ChainerMNTrial.suggest_discrete_uniform"><code class="name flex">
<span>def <span class="ident">suggest_discrete_uniform</span></span>(<span>self, name: str, low: float, high: float, q: float) ‑> float</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def suggest_discrete_uniform(self, name: str, low: float, high: float, q: float) -&gt; float:
    def func() -&gt; float:

        assert self.delegate is not None
        return self.delegate.suggest_discrete_uniform(name, low, high, q)

    return self._call_with_mpi(func)</code></pre>
</details>
</dd>
<dt id="optuna.integration.chainermn.ChainerMNTrial.suggest_float"><code class="name flex">
<span>def <span class="ident">suggest_float</span></span>(<span>self, name: str, low: float, high: float, *, step: Union[float, NoneType] = None, log: bool = False) ‑> float</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def suggest_float(
    self,
    name: str,
    low: float,
    high: float,
    *,
    step: Optional[float] = None,
    log: bool = False
) -&gt; float:
    def func() -&gt; float:
        assert self.delegate is not None
        return self.delegate.suggest_float(name, low, high, log=log, step=step)

    return self._call_with_mpi(func)</code></pre>
</details>
</dd>
<dt id="optuna.integration.chainermn.ChainerMNTrial.suggest_int"><code class="name flex">
<span>def <span class="ident">suggest_int</span></span>(<span>self, name: str, low: int, high: int, step: int = 1, log: bool = False) ‑> int</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def suggest_int(self, name: str, low: int, high: int, step: int = 1, log: bool = False) -&gt; int:
    def func() -&gt; int:

        assert self.delegate is not None
        return self.delegate.suggest_int(name, low, high, step=step, log=log)

    return self._call_with_mpi(func)</code></pre>
</details>
</dd>
<dt id="optuna.integration.chainermn.ChainerMNTrial.suggest_loguniform"><code class="name flex">
<span>def <span class="ident">suggest_loguniform</span></span>(<span>self, name: str, low: float, high: float) ‑> float</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def suggest_loguniform(self, name: str, low: float, high: float) -&gt; float:
    def func() -&gt; float:

        assert self.delegate is not None
        return self.delegate.suggest_loguniform(name, low, high)

    return self._call_with_mpi(func)</code></pre>
</details>
</dd>
<dt id="optuna.integration.chainermn.ChainerMNTrial.suggest_uniform"><code class="name flex">
<span>def <span class="ident">suggest_uniform</span></span>(<span>self, name: str, low: float, high: float) ‑> float</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def suggest_uniform(self, name: str, low: float, high: float) -&gt; float:
    def func() -&gt; float:

        assert self.delegate is not None
        return self.delegate.suggest_uniform(name, low, high)

    return self._call_with_mpi(func)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="optuna.integration" href="index.html">optuna.integration</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="optuna.integration.chainermn.ChainerMNStudy" href="#optuna.integration.chainermn.ChainerMNStudy">ChainerMNStudy</a></code></h4>
<ul class="">
<li><code><a title="optuna.integration.chainermn.ChainerMNStudy.optimize" href="#optuna.integration.chainermn.ChainerMNStudy.optimize">optimize</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="optuna.integration.chainermn.ChainerMNTrial" href="#optuna.integration.chainermn.ChainerMNTrial">ChainerMNTrial</a></code></h4>
<ul class="">
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.datetime_start" href="#optuna.integration.chainermn.ChainerMNTrial.datetime_start">datetime_start</a></code></li>
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.distributions" href="#optuna.integration.chainermn.ChainerMNTrial.distributions">distributions</a></code></li>
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.number" href="#optuna.integration.chainermn.ChainerMNTrial.number">number</a></code></li>
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.params" href="#optuna.integration.chainermn.ChainerMNTrial.params">params</a></code></li>
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.report" href="#optuna.integration.chainermn.ChainerMNTrial.report">report</a></code></li>
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.set_system_attr" href="#optuna.integration.chainermn.ChainerMNTrial.set_system_attr">set_system_attr</a></code></li>
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.set_user_attr" href="#optuna.integration.chainermn.ChainerMNTrial.set_user_attr">set_user_attr</a></code></li>
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.should_prune" href="#optuna.integration.chainermn.ChainerMNTrial.should_prune">should_prune</a></code></li>
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.suggest_categorical" href="#optuna.integration.chainermn.ChainerMNTrial.suggest_categorical">suggest_categorical</a></code></li>
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.suggest_discrete_uniform" href="#optuna.integration.chainermn.ChainerMNTrial.suggest_discrete_uniform">suggest_discrete_uniform</a></code></li>
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.suggest_float" href="#optuna.integration.chainermn.ChainerMNTrial.suggest_float">suggest_float</a></code></li>
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.suggest_int" href="#optuna.integration.chainermn.ChainerMNTrial.suggest_int">suggest_int</a></code></li>
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.suggest_loguniform" href="#optuna.integration.chainermn.ChainerMNTrial.suggest_loguniform">suggest_loguniform</a></code></li>
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.suggest_uniform" href="#optuna.integration.chainermn.ChainerMNTrial.suggest_uniform">suggest_uniform</a></code></li>
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.system_attrs" href="#optuna.integration.chainermn.ChainerMNTrial.system_attrs">system_attrs</a></code></li>
<li><code><a title="optuna.integration.chainermn.ChainerMNTrial.user_attrs" href="#optuna.integration.chainermn.ChainerMNTrial.user_attrs">user_attrs</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.1</a>.</p>
</footer>
</body>
</html>